image:
  file: .gitpod.Dockerfile

tasks:
  - before: >
      mkdir -p $PYTHONUSERBASE/lib/python3.8/site-packages/ &&
      pip3 install -e . &&
      export COCOTB_REDUCED_LOG_FMT=1
    init: >
      cd /workspace/cocotbext-axi/tests/axil/ &&
      gp open Makefile &&
      gp open test_axil.v &&
      gp open test_axil.py &&
      make SIM=icarus sim &&
      SIM=icarus pytest -o log_cli=True --junitxml=test-results.xml --cocotbxml=test-cocotb.xml &&
      make SIM=verilator sim &
    command: >
      cd /workspace/cocotbext-axi/tests/axil/ ;
      history -s make SIM=icarus WAVES=1 sim ;
      history -s SIM=icarus pytest -o log_cli=True --junitxml=test-results.xml --cocotbxml=test-cocotb.xml ;
      history -s make SIM=verilator sim ;
      history -s gtkwave *.fst --rcvar \'initial_window_x 1920\' --rcvar \'initial_window_y 1061\' --rcvar \'do_initial_zoom_fit yes\' ;
      history -d 3

# NOTE: the geometry for gtkwave's fullscreen size can be found with xwininfo -root

# https://www.gitpod.io/docs/config-ports/
ports:
  - port: 6080  # VNC for e.g. gtkwave
    onOpen: notify
  - port: 5900
    onOpen: ignore

vscode:
  extensions:
    - mshr-h.veriloghdl@1.0.6:RPslnvyzniF7C66mxHT+Hg==
    - puorc.awesome-vhdl@0.0.1:w0lXwxIDreee5Mbtg9XSfg==
